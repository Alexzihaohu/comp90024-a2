<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <div id="map"></div>
    <div id="text">
        <div id="main"></div>
        <div id="main2"></div>
    </div>

</body>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        z-index: 1;


    }


    .sparkline {
        height: 100px;
        width: 2000px;
    }

    #main {
        width: 200px;
        height: 200px;
        background-color: rgb(227, 232, 236);
        z-index: 100;

    }

    #main2 {
        width: 200px;
        height: 200px;
        background-color: rgb(227, 232, 236);
        z-index: 100;

    }

    #text {
        position: absolute;
        top: 0;
        left: 0;
        width: 220px;
        min-height: 200px;
        background-color: rgb(227, 232, 236);
        z-index: 100;
        /* opacity: 0; */
        /* display: block; */
        display: none;
        padding: 20px;
        padding-left: 40px;
        border-radius: 3px;


    }
</style>
<script src="./echarts.js"></script>
<!-- Load the `mapbox-gl-geocoder` plugin. -->
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css" type="text/css">
<script>

    mapboxgl.accessToken = 'pk.eyJ1IjoieGlubGk5OTYiLCJhIjoiY2tmN28xbzFwMDQ1dzJ5cGxmYnl4MmNmbiJ9.WwZMR2F-V57vhOVf69H9dQ';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/xinli996/ckof99r0t1ltx17lnwpxfmj5f',
        center: { lat: -37.8136, lng: 144.9631 },
        zoom: 3
    });

    let data__ = [
        {
            'type': 'Feature',
            'properties': {
                "title": 'Melbourne',
                'description':
                    '<strong>Melbourne Facts</strong><p>Median Age: 30</p ><p>housing price: 5000</p >',
                'data': [12, 24, 34],
                "age": 20,
                "price": 200,
                data2: {
                    "volleyball": 90,
                    "squash": 70,
                    "tennies": 80
                }

            },
            'geometry': {
                'type': 'Point',
                'coordinates': [144.9631, -37.8136]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                "title": "Adelaide",
                'description':
                    '<strong>Adelaide Facts</strong><p>Median Age: 40</p ><p>housing price: 4000</p >',
                'data': [10, 20, 30],
                "age": 40,
                "price": 500,
                data2: {
                    "gyml": 90,
                    "skiing": 70,
                    "skating": 50
                }

            },
            'geometry': {
                'type': 'Point',
                'coordinates': [138.6007, -34.9285]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                "title": "Canberra",
                'description':
                    '<strong>Canberra Facts</strong><p>Median Age: 50</p ><p>housing price: 3000</p >',
                'data': [40, 50, 60],
                "age": 10,
                "price": 100,
                data2: {
                    "tennis": 90,
                    "boxing": 50,
                    "gym": 80
                }


            },
            'geometry': {
                'type': 'Point',
                'coordinates': [149.13, -35.2809]
            }
        },
        {
            'type': 'Feature',
            'properties': {
                "title": "Sydney",
                'description':
                    '<strong>Sydney Facts</strong><p>Median Age: 20</p ><p>housing price: 5000</p >',
                'data': [20, 30, 40],
                "age": 20,
                "price": 700,
                data2: {
                    "basketball": 90,
                    "squash": 70,
                    "racing": 80
                }

            },
            'geometry': {
                'type': 'Point',
                'coordinates': [151.2093, -33.8688]
            }
        },

    ].map((d) => {

        d.properties.pricer = d.properties.price / 20
        return d
    })
    map.on('load', function () {

        map.addSource('places', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': data__
            }
        });


        // Add a layer showing the places.
        map.addLayer({
            'id': 'places',
            'type': 'circle',
            'source': 'places',
            'paint': {
                'circle-color': '#4264fb',
                'circle-radius': ["get", "pricer"],
                'circle-stroke-width': 2,
                'circle-stroke-color': '#ffffff'
            }
        });

        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });
        $("#text").mouseleave(() => {
            $("#text").html("")
            $("#text").css("display", "none")

        })

        map.on('mouseover', 'places', function (e) {
            // Change the cursor style as a UI indicator.
            map.getCanvas().style.cursor = 'pointer';

            //var marker = e.layer,
            console.log(e);
            var marker = e.features[0];
            $("#text").html(`
            <h3>${marker.properties.title}</h3>
            <p style="font-size:15px">Median Age: ${marker.properties.age}</p>
            <p style="font-size:15px">Median Housing Price: $${marker.properties.price}</p>
            
            <div id='main'></div>
            <p style=" text-align: center;font-size:13px">Total Sports Tweets</p>
            <div id="main2"></div>

            <p style="text-align: center;font-size:13px"> Top 3 Most Popular Sports </p>

            `)
            // $("#text").css("opacity", 1)
            $("#text").css("display", "block")
            $("#text").css("top", e.point.y);
            $("#text").css("left", e.point.x);


            var chartDom = document.getElementById('main');
            var myChart = echarts.init(chartDom);
            var option;
            var chartDom2 = document.getElementById('main2');
            var myChart2 = echarts.init(chartDom2);
            var option2;
            let a = [], b = [];
            console.log(marker.properties.data2)
            for (_ in JSON.parse(marker.properties.data2)) {
                a.push(_) 
                console.log(_)
                b.push(JSON.parse(marker.properties.data2)[_])
            }
            //bar 
            option2 = {
                grid: {
                    left: '0%',
                    right: '3%',
                    bottom: '3%',
                    containLabel: true
                },
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    max: 'dataMax',
                    //min: 30,
                    splitNumber:3,

                },
                yAxis: {
                    type: 'category',
                    data: a,
                    inverse: true
                },
                series: [{
                    realtimeSort: true,
                    name: 'Total',
                    type: 'bar',
                    data: b,

                }],


            };
            //line
            option = {

                tooltip: {
                    trigger: 'axis'
                },

                grid: {
                    left: '3%',
                    right: '8%',
                    bottom: '3%',
                    containLabel: true
                },
                toolbox: {
                    feature: {
                        // saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ["2019", "2020", "2021"]
                },
                yAxis: {
                    type: 'value',
                    min: "dataMin"
                },
                series: [
                    {
                        name: 'Total',
                        type: 'line',

                        data: JSON.parse(marker.properties.data)
                    },

                ]
            };
            //line graph
            myChart.setOption(option, true);
            //bar chart
            myChart2.setOption(option2, true);
            // console.log(marker.properties.data);

        });

        map.on('mouseleave', 'places', function () {
            map.getCanvas().style.cursor = '';

        });

        // Add the control to the map.
map.addControl(
new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
mapboxgl: mapboxgl
})
);
    });


// window.addEventListener("load",()=>{

// })

</script>

</html>