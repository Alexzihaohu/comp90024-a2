{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!--    Group 39
            Zihao Yang
            Wei Li
            Yuqi Zhang
            Xin Li
            Zihao Hu -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="icon" href="{% static "/img/favicon.ico"%}" type="image/x-icon" / >
  <title>COMP90024 Home</title>
  <!--import bootstrap and jquery -->
  <link rel="stylesheet" type="text/css" href="{% static "/css/normalize.css"%}">
  <link rel="stylesheet" href="{% static "/bootcss/bootstrap.min.css" %}">
  <script src="{% static "/jquery/jquery.min.js" %}"></script>
  <script src="{% static "/bootjs/bootstrap.min.js" %}"></script>
  <script src="{% static "/bootjs/bootstrap.min.js" %}"></script>

<!--  import style sheet-->
  <link rel="stylesheet" type="text/css" href="{% static "/css/style.css"%}"/>
  <link rel="stylesheet" href="{% static "/css/fa/css/all.css"%}">

</head>
<body id="home">
  <div class="container">
    <!--    side nav-->
    <div class="col-md-2 column sidenav">
      <div class="col-md-12 column sidenavin">
        <img alt="140x140" src="{% static "/img/unimelb.png"%}" />
        <ul>
          <li class="this">
            <a style="color: #094183" href="/home/">&nbsp<i class="fas fa-home"></i>&nbsp&nbspHome</a>
          </li>
          <li>
            <a href="/map/">&nbsp<i class="fas fa-map"></i>&nbsp&nbspMap</a>
          </li>
          <li>
            <a href="/statistics/">&nbsp<i class="fas fa-chart-bar"></i>&nbsp&nbspStatistics</a>
          </li>
          <li class="Manage">
            <a href="/" onclick="event.target.port=9000">&nbsp<i class="fas fa-cogs"></i>&nbsp&nbspManage</a>
          </li>
          <li class="haproxy">
            <a href="/haproxy-admin/">&nbsp<i class="fas fa-sitemap"></i>&nbsp&nbspHAProxy</a>
          </li>
          <li class="spark">
            <a href="/" onclick="event.target.port=8080">&nbsp&nbsp<i class="fas fa-bolt"></i>&nbsp&nbsp&nbspSpark</a>
          </li>
          <li class="couchdb">
            <a href="/" onclick="event.target.port=5984">&nbsp<i class="fas fa-couch"></i>&nbsp&nbspCouchDB</a>
          </li>
        </ul>
      </div>
    </div>
    <!--      content for this page-->
    <div class="col-md-10 column right-content">
      <div class="home-right">
        <h1>Twitterlance</h1>
        <h3>COMP90024 Team 39</h3>
          <div class="help">
            <span class="helptext" >
              &nbspScroll down this page, start the jobs with corresponding buttons&nbsp
            </span>&nbsp
            <i class="fa fa-question-circle"></i>
          </div>
      </div> 

      <div class="col-md-12 about-right">
        <div class="frame text-center">About the Project</div>
        <div class="frame-detail">
          <p>
            Twitterlance is a distributed system that harvests, stores, and analyses Twitter users and their timelines. To ensure the user experience, the architecture design has been aiming at high scalability, high availability and high automation. High Scalability is supported by the combination of CouchDB, Docker, Docker Swarm, and Ansible. High availability is a design objective embedded in the error handling methods of all software components in the system, while the duplication of services also makes a contribution to this goal. The purpose of high automation is to provide a one-click solution for deployment and scaling. With Ansible and Docker Swarm, it is extremely easy to scale up the data and harvesting/analysis performance when new resources are available on the cloud. The automated deployment is designed for Melbourne Research Cloud only, where the system is currently deployed.
          </p>
          <p>
            The system conducts two major tasks: data harvesting and data analysis. The process of harvesting consists of two phases: collecting users and collecting tweets, which can be initiated via the home page of the web application. Data analysis is implemented with the integration of Django, CouchDB, and Apache Spark, which are all running as scalable clusters.
          </p>
          <p>Our research includes three scenarios: to identify the most vibrant city, to find out the most popular sports, and to pickout the sports enthusiasts across 6 major cities in Australia.</p>
        </div>
        <div class="frame text-center">About Us</div>
        <div class="col-md-12 column member">
          <div class="col-md-2 column">
            <ul>
              <li class="pic"><img src="{% static "/img/zhyhead.png"%}" alt="member"></li>
              <li class="name">Zihao Yang</li>
              <li class="number">1252410</li>
              <li class="task">Backend, Ansible, Docker, CouchDB, Spark</li>
            </ul>
          </div>
          <div class="col-md-2 column">
            <ul>
              <li class="pic"><img src="{% static "/img/wlhead.png"%}" alt="member"></li>
              <li class="name">Wei Li</li>
              <li class="number">956833</li>
              <li class="task">Twitter Search, Backend, CouchDB View</li>
            </ul>
          </div>
          <div class="col-md-2 column">
            <ul>
              <li class="pic"><img src="{% static "/img/yqzhead.png"%}" alt="member"></li>
              <li class="name">Yuqi Zhang</li>
              <li class="number">777603</li>
              <li class="task">Frontend Charts, Twitter Search, CouchDB View</li>
            </ul>
          </div>
          <div class="col-md-2 column">
            <ul>
              <li class="pic"><img src="{% static "/img/xlhead.png"%}" alt="member"></li>
              <li class="name">Xin Li</li>
              <li class="number">1029029</li>
              <li class="task">Frontend Maps, Data Analysis, CouchDB View</li>
            </ul>
          </div>
          <div class="col-md-2 column">
            <ul>
              <li class="pic"><img src="{% static "/img/zhhhead.png"%}" alt="member"></li>
              <li class="name">Zihao Hu</li>
              <li class="number">977716</li>
              <li class="task">Twitter Stream, Overall Frontend, Ansible</li>
            </ul>
          </div>
        </div>
        <div class="col-md-12 job-control">
        <div class="row">
          <div class="col-md-12" style="width: 100%">
            <div class="col-md-2" style="padding-top: 8px; padding-left: 5px;">
              <div class="startjobstatus">
                Search:&nbsp<span id="searchstatus">loading</span>
              </div>
            </div>
            <div class="col-md-2" style="padding-top: 8px;">
              <div class="startjobstatus">
                Stream:&nbsp<span id="streamstatus">loading</span>
              </div>
            </div>
            <div class="col-md-2" style="padding-top: 8px;">
              <div class="startjobstatus">
                Update:&nbsp<span id="updatestatus">loading</span>
              </div>
            </div>
            <div class="col-md-2" style="padding-top: 8px;">
            </div>
            <div class="col-md-4">
              <div class="input-group">
                <input type="number" class="form-control" min="1" max="1000" placeholder="Input search quantity">
                <span class="input-group-btn">
                <button disabled="disabled" class="btn btn-default" type="button" style="margin-right: 5px">Add New Users</button>
                <button disabled="disabled" class="btn btn-default" type="button">Search User Tweets</button>
                <button disabled="disabled" class="btn btn-default" type="button" style="margin-right: 5px">Stop</button>
                <button disabled="disabled" class="btn btn-default" type="button">Start Stream</button>
                <button disabled="disabled" class="btn btn-default" type="button">Stop</button>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      </div>

    </div>
  </div>
</body>
<script>
  window.onload=function(){

    let searchstatus = document.getElementById('searchstatus');
    let streamstatus = document.getElementById('streamstatus');
    let updatestatus = document.getElementById('updatestatus');
    let couchdbstatus = document.getElementById('couchdbstatus');
    let btn = document.getElementsByTagName("button");
    console.log(btn)
    let searchbtn = btn[0];
    let updatebtn = btn[1];
    let stopupdatebtn = btn[2]
    let startstreambtn = btn[3];
    let stopstreambtn = btn[4];
    let input = document.getElementsByTagName("input")[0].value;

    function startjobstatus(url_,status,btn){
      $.ajax({
        url: url_,
        type: "get",
        headers:{'Content-Type':'application/json'},
        dataType: "json",
        success: function(data,textStatus,jqxhr){
          status.innerHTML = data["status"]
          if(data["status"]==="idle"){
            btn.disabled=false;
          }
        },
        error:function(jqxhr,textStatus,error){
          console.log(error);
          console.log(textStatus);
          console.log(jqxhr);
        },
      })
    }
    startjobstatus("/analyser/jobs/search/",searchstatus,searchbtn);
    startjobstatus("/analyser/jobs/update/",updatestatus,updatebtn);
    startjobstatus("/analyser/jobs/stream/",streamstatus,startstreambtn);

    function stopjobstatus(url_,status,btn){
      $.ajax({
        url: url_,
        type: "get",
        headers:{'Content-Type':'application/json'},
        dataType: "json",
        success: function(data,textStatus,jqxhr){
          status.innerHTML = data["status"]
          if(data["status"] != "idle"){
            btn.disabled=false;
          }
        },
        error:function(jqxhr,textStatus,error){
          console.log(error);
          console.log(textStatus);
          console.log(jqxhr);
        },
      })
    }
    stopjobstatus("/analyser/jobs/update/",streamstatus,stopupdatebtn);
    stopjobstatus("/analyser/jobs/stream/",streamstatus,stopstreambtn);

    function searchjobcontrol(url_,data_){
      $.ajax({
        url: url_,
        type: "put",
        data: JSON.stringify(data_),
        headers:{'Content-Type':'application/json'},
        dataType: "json",
        success: function(data,textStatus,jqxhr){
          console.log(data);
          console.log(textStatus);
          console.log(jqxhr);
        },
        error:function(jqxhr,textStatus,error){
          console.log(error);
          console.log(textStatus);
          console.log(jqxhr);
        },
      })
      location.reload();
    }
    function jobcontrol(url_){
      $.ajax({
        url: url_,
        type: "put",
        headers:{'Content-Type':'application/json'},
        dataType: "json",
        success: function(data,textStatus,jqxhr){
          console.log(data);
          console.log(textStatus);
          console.log(jqxhr);
        },
        error:function(jqxhr,textStatus,error){
          console.log(error);
          console.log(textStatus);
          console.log(jqxhr);
        },
      })
      location.reload();
    }
    function stopjobcontrol(url_){
      $.ajax({
        url: url_,
        type: "delete",
        headers:{'Content-Type':'application/json'},
        dataType: "json",
        success: function(data,textStatus,jqxhr){
          console.log(data);
          console.log(textStatus);
          console.log(jqxhr);
        },
        error:function(jqxhr,textStatus,error){
          console.log(error);
          console.log(textStatus);
          console.log(jqxhr);
        },
      })
      location.reload();
    }
    searchbtn.addEventListener('click',function(){
      input = document.getElementsByTagName("input")[0].value;
      if (input > 3000 || input < 1 ){
        alert("out of range");
      }else{
        input = {"new_users": input};
        console.log(input);
        searchjobcontrol("/analyser/jobs/search/",input);
        document.getElementsByTagName("input")[0].disabled=true;
        searchbtn.disabled=true;
      }
    })
    updatebtn.addEventListener('click',function(){
      jobcontrol("/analyser/jobs/update/");
      updatebtn.disabled=true;
    })
    stopupdatebtn.addEventListener('click',function(){
      stopjobcontrol("/analyser/jobs/update/");
      stopupdatebtn.disabled=true;
    })
    startstreambtn.addEventListener('click',function(){
      jobcontrol("/analyser/jobs/stream/");
      startstreambtn.disabled=true;
    })
    stopstreambtn.addEventListener('click',function(){
      stopjobcontrol("/analyser/jobs/stream/");
      stopstreambtn.disabled=true;
    })
  }
</script>
</html>
